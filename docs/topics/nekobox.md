---
layout: doc
outline: deep
lang: 'fa-IR'
dir: 'rtl'
title: 'نکوباکس اندروید'
description: 'نکاتی که قبل از استفاده از نکوباکس باید بدونیم'
date: 2025-06-17
editLink: true
head:
  - - meta
    - name: keywords
      content: NekoBox, nekobox, NB4A, nekobox for Android, Exclave, Android, v2ray, singbox, clients, xray, clash meta
---

# نکوباکس اندروید — NB4A {#notes}

[[toc]]

<br/> 

## نکته اول - آپدیت نشدن برخی ساب‌ها

> پیرامون نکوباکس [نسخه 1.4.0][1]

توی آپدیت آخر یه سری لینک‌های ساب به کلاینت اضافه نمیشن‌هاااا، تو بکاپ خودم اون آخراش ده تا لینک ساب هست که آپدیت نمیشن درحالی که توی کلاینت‌های دیگه اوکی هستن، دلیلشم نمی‌دونم هنوز. اگه این مسأله براتون مهمه اصلا آپدیت نکنید به این نسخه. هم‌چنان پیشنهاد من استفاده از [Exclave][2] هست. قابلیت [بالانسر](#balancer) اون می‌ارزه به کل هیکل نکوباکس ادایی

::: details **`از جمله ساب‌هایی که آپدیت نمیشن`**

<Ltr>

- https://robin.victoriacross.ir

- https://raw.githubusercontent.com/Rayan-Config/C-Sub/refs/heads/main/configs/proxy.txt

- https://raw.githubusercontent.com/MatinGhanbari/v2ray-configs/refs/heads/main/subscriptions/base64/all_sub.txt

- https://raw.githubusercontent.com/Kolandone/v2raycollector/refs/heads/main/ss.txt

- https://v2.alicivil.workers.dev/

- https://raw.githubusercontent.com/4n0nymou3/multi-proxy-config-fetcher/refs/heads/main/configs/proxy_configs.txt

</Ltr>

حالا خیلی‌ام مهم نیست وقتی خودمون [مخزن انواع لینک ساب داریم][3]، این نشد یکی دیگه :sneezing_face: :sweat_smile:

:::

<br/> 

## نکته دوم - آپدیت نبودن فایل‌های قوانین {#assets}

**Manage route assets**

مشکلات مثل همیشه حول محور Routing Rules می‌چرخن.

> اگه قوانین مسدودسازی تبلیغات و بای‌پس شدن آی‌پی و سایت‌های ایرانی برات مهم نیست اصلا نخون بقیه مطلب رو.

من قوانین رو از بخش Route خاموش کردم در هردو فایل بکاپ چون اگه برای کسی دوتا فایل geosite و geoip آپدیت نمی‌بود دیگه هیچ کانفیگی وصل نمی‌شد. پیش‌فرض خاموشش کردم و اگه برات مهمه بتونی با vpn روشن بری توی سایت‌های ایرانی و هم‌چنین می‌خوای یه سری از تبلیغات سایت ها مسدود بشن پس اول برو توی بخش Route مثل این اسکرین‌شات:

::: details مشاهده اسکرین‌شات

<br/> 
<p align="center">
  <img src="/clients/NB4A-1.png" alt="Routing-Rules" width="640px" />
</p>

:::

**بعد برو اینجا**

::: details مشاهده اسکرین‌شات

<br/> 
<p align="center">
  <img src="/clients/NB4A-2.png" alt="Routing-Rules2" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/NB4A-3.png" alt="Routing-Rules3" width="640px" />
</p>

:::

و اینجا باید کلیک کنی روی Update و صبر کنی هردو فایل geo assets آپدیت بشن، داخل تصویر هم نوشتم که بعد از آپدیت شدن زیرشون باید تاریخ بروز نوشته شده باشه.

::: details مشاهده اسکرین‌شات

<br/>
<p align="center">
  <img src="/clients/NB4A-4.png" alt="Routing-Rules4" width="640px" />
</p>

:::

حالا که اینا آپدیت شدن می‌تونی برگردی صفحه قبلی و هر قانونی که خواستی رو روشن کنی، پیشنهاد می‌کنم همه رو روشن کنی، همه بجز آخری (Block Ads - Full)،   
آخری خیلی سنگینه و اضافه کاریه، اون روشن باشه به هر کانفیگی بخوای وصل بشی یکی دوثانیه طول می‌کشه استارت شدنش.

::: details مشاهده اسکرین‌شات

<br/> 
<p align="center">
  <img src="/clients/NB4A-5.png" alt="Routing-Rules5" width="640px" />
</p>

:::

## بای‌پس کردن اپلیکیشن‌های داخلی {#bypass}

**Allow apps to bypass VPN**

اگه بخوای وقتی که کلاینت فعاله به برنامه ایرانسل‌من سر بزنی باز نمیشه چون باید با آی‌پی ایران واردش بشی، برای اینکه نخوای کلاینت رو هر دقیقه خاموش روشن کنی بهتره بیای و اپ‌های ایرانی رو اضافه کنی توی لیست استثناها. از کجا؟؟  
از این مسیر:

<Ltr>

> Nekobox settings → Apps VPN Mode → Bypass

</Ltr>

::: details مشاهده اسکرین‌شات

<br/> 
<p align="center">
  <img src="/clients/NB4A-6.png" alt="Apps-VPN-Mode" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/NB4A-7.png" alt="Apps-VPN-Mode2" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/NB4A-8.png" alt="Apps-VPN-Mode3" width="640px" />
</p>

:::

ایرانسل‌من، شاتل‌من، برق من، شاد، روبیکا، ایتا و بقیه لاشی‌های وطنی رو فعال کن که دیکه از تونل وی‌پی‌ان عبور نکنه ترافیک اون‌ها.  
تو قسمت اول این مطلب سایت‌ها و آی‌پی های ایرانی رو بای‌پس کردیم که خارج از تونل وی‌پی‌ان به فعالیتشون ادامه بدن و الان هم برای برنامه‌های نصب شده روی گوشیمون اینکارو انجام دادیم. وسلام علیکم و رحمه‌الله و برکاته :satisfied:

<br/>

## نحوه وارد کردن فایل بکاپ {#import}

**Import backup files**

اول فایل بکاپ من یا هرکس دیگه رو دانلود و ذخیره کن

- [لینک فایل بکاپ نکوباکس][4]
- [لینک فایل بکاپ Exclave][9]

::: details مشاهده اسکرین‌شات

<br/> 
<p align="center">
  <img src="/clients/NB4A-9.png" alt="Apps-VPN-Mode4" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/NB4A-10.png" alt="Backup-Files" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/NB4A-11.png" alt="Backup-Files2" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/NB4A-12.png" alt="Backup-Files3" width="640px" />
</p>

:::

### بخش‌های مختلف فایل‌بکاپ {#backup-sec}

**فایل‌های بکاپ سه بخش مختلف دارن:**

1. کانفیگ‌ها
2. قوانین
3. تنظیمات کلاینت

همیشه می‌تونی بخش قوانین و تنظیمات رو با خیال راحت  تیک بزنی و وارد کلاینت بکنی ولی حواست باشه بخش سوم یعنی کانفیگ‌هارو اگه تیک زدی جایگزین کانفیگ‌های خودت قراره بشن و هرچی از قبل داشتی داخل کلاینت حدف میشه پس بهتره قبل از وارد کردن بکاپ من، از همین منوی tools که توی اسکرین شات نشون دادم اول از کانفیگ‌ها و تنظیمات خودت بکاپ بگیری (با گزینه Export). اگر هم که کانفیگ خاصی نداری و یا مهم نیستن که اوکی ایگنور کن بره و هرجا هر فایلی دیدی اد کن خدا بده برکت. 

اگه متوجه نشدی و نیاز به ویدئو آموزش داری یه سری ویدئوی قدیمی [اینــجا][6] و یکی دوتا هم [اینــجا][7] پیدا میشن.

<br/>

## آپدیت لینک‌ساب و تست کانفیگ‌ها {#update-subl}

**Update subscription links**

یه هفته با گلابی وی‌پی‌ان بودی حالا برگشتی سراغ نکوباکس یا exclave یا ویتوری یا هرچی. اگه لینک ساب عمومی استفاده می‌کنی پس الان کانفیگ‌های داخلش مردن، اولین کاری که باید بکنی اینه که:

::: details مشاهده اسکرین‌شات

<p align="center">
  <img src="/clients/NB4A-13.png" alt="Update-Test" width="640px" />
</p>

:::

اول از همه وارد گروه مورد نظرت میشی و گزینه:

<Ltr>

:orange_circle: `Update current Groups subscription`

</Ltr>

رو میزنی و صبر می‌کنی تا آپدیت بشه.

<br/>

دومین کاری که باید بکنی اینه که گزینه:

<Ltr>

:yellow_circle: `Remove Duplicate servers`

</Ltr>
<br/>

رو بزنی نا کانفیگ‌های تکراری حذف بشن و الکی وقت و حجم اینترنت تلف نشه واسه تست گرفتن از اینا.  
اگه بکاپ منو زدی پس این گزینه نیاز نیست، موقع آپدیت خودش تکراری‌هارو حذف می‌کنه چون از داخل خود گروه گزینشو روشن کردم.

سومین کاری که باید بکنی زدن گزینه است:

<Ltr>

:green_circle: `URL Test`

</Ltr>
<br/>

حواست باشه قبل از انجام این تست وی‌پی‌ان هرچی که هست باید خاموش بشه وگرنه نتایج تست درست درنمیان.  

و آخرین کار اینه که گزینه:

<Ltr>

:red_circle: `Order/By Delay`

</Ltr>
<br/>

رو بزنی که کانفیگ‌ها به ترتیب بهتر بودن سرعت و پینگشون توی لیست قرار بگیرن، یک‌بار زدن این گزینه کافیه.

حالا به یکی از کانفیگ‌هایی که ابتدای لیسته و کنارش  عدد کوچولوی سبز نوشته می‌تونی کانکت بشی. اونایی که Timeout زده کنارشون به گاج رفتن دیگه.

# بالانسر Exclave

> **یکی از بهترین کلاینت‌ها با هسته Singbox برای اندروید**

مهم‌ترین دلیلی که میگم بجای نکوباکس بهتره از این استفاده بکنیم قابلیت `بالانسر — Balancer` اونه. 

اگه یکی از فایل‌های بکاپی که من توی انباری میذاشتم بهش اضافه کرده باشی قطعا دیدی که تو صفحه اول یه سری کانفیگ‌ هست که اینا نرمال نیستن و زیرشون نوشته Balancer, اونوقت این کانفیگ‌های Balancer چی هستن و چجوری ایجاد شدن؟؟

فرضا تو نکوباکس اگه یه لینک ساب داشته باشی و مثلا صدتا کانفیگ داخلش باشه طبق روال عادی URL Test می‌گیریم به کانفیگ‌ اولی یا دومی که پینگ بهتری دادن وصل می‌شیم، اگه بعد چند دقیقه یا چند ساعت ضعیف شد یا اختلال داشت یا اتصال کاذب بود یا از کار افتاد و هر دلیلی دیگه ای ... اونوقت باید دوباره برگردیم داخل نکوباکس و یکی دیگه رو انتخاب کنیم، سردرد.

ولی اینجا داخل کلاینت Exclave چیکار می‌کنیم؟؟ از بالای صفحه از آیکون `+` منوی `manual settings` رو باز کرده و از انتهای لیست کانفیگ `load balance` رو انتخاب می‌کنیم مثل این اسکرین شات:

::: details مشاهده اسکرین‌شات

<br/> 
<p align="center">
  <img src="/clients/EX-1.png" alt="Balancer" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/EX-2.png" alt="Balancer2" width="640px" />
</p><br/>

<p align="center">
  <img src="/clients/EX-3.png" alt="Balancer3" width="640px" />
</p>

:::

**حالا اینجا کانفیگ رو تنظیم می‌کنیم:**

1. **Profile Name:** ←یه اسم دلخواه

2. **Type:** ← Group انتخاب گروه به عنوان ورودی

3. **Strategy:** ← leastPing انتخاب کانفیگ با کمترین پینگ

4. **Custom test URL:** ← خالی باشه

5. **Balancer observation interval:** ← 300 اوکیه

و در نهایت از گوشه بالای تصویر ✔️ ذخیره می‌کنیم.

::: details مشاهده اسکرین‌شات

<br/>
<p align="center">
  <img src="/clients/EX-4.png" alt="Balancer4" width="640px" />
</p>

:::

حالا یه کانفیگ با اسمی که انتخاب کردیم انتهای لیست اضافه شده، کلیک کنیم روش و دکمه استارت رو بزنیم باید وصل بشه، 

::: details مشاهده اسکرین‌شات

<br/>
<p align="center">
  <img src="/clients/EX-5.png" alt="Balancer5" width="640px" />
</p>

:::

<br/>

**خب حالا چه اتفاقی افتاد؟؟**

الان ما یه کانفیگی ساختیم که یه لینک ساب بهش دادی به عنوان ورودی و تعیین کردیم بیاد هر چند ثانیه یکبار از کانفیگ‌های داخل این ساب تست URL بگیره و اون‌هایی که پینگ بهتری دارن رو ابتدای لیست اتصال قرار بده یعنی همیشه به بهترینشون وصل بشه،

حالا با این شرایط از بین فرضا هزارتا کانفیگ تا لحظه گ‌ای که آخرین کانفیگ از کار بیافته وصل می‌مونیم چون هرکدوم از کار افتاد درجا بعدی رو فعال می‌کنه و بعدی رو و بعدی رو، دیکه مثل نکوباکس نیاز نیست بریم سراغش و دستی انتخاب کنیم،

ایده خوبیه این، بودنش خیلی مفیده، میشه گفت مثل هیدیفای یا clash و singbox عمل می‌کنه، ولی حداقل بدون باگ هست و مثل هیدیفای (بلا به دور :sneezing_face: :sweat_smile:) آدمو روانی نمی‌کنه !  

::: tip **Type: Group or List**

گزینه دوم رو ما روی Group قرار دادیم چون می‌خوایم لینک‌ساب دلخواهمون بالانسر بسازیم، ولی اگه ما لینک ساب نداشته باشیم و صرفا چندتا کانفیک بدون دسته بندی باشن توی کلاینت، اونوقت می‌تونیم برای این بخش کزینه List رو انتخلب بکنیم و بعد از پایین صفحه روی add profile می‌زنیم و کانفیگ‌های مورد نظرمون رو اضافه می‌کنیم،

:::

<br/> 

::: tip **Strategy: leastPing or leastLoad**

ما گزینه سوم یعنی استراتژی رو گذاشتیم روی `leastPing` همونطور که گفتم تست URL می‌گیره و کانفیگی که بهترین پینگ رو داشت برامون اکتیو می‌کنه.

ولی یه استراتژی دیگه هم داشت به اسم `leastload` این برای مواقعی مناسبه که لینک ساب‌اسکریپشن ما شخصیه و یا روی سرور خودمونه و می‌دونیم که پینگ همه کانفیگ‌ها تقریبا باهم برابر هستش پس میایم leastLoad رو انتخاب می‌کنیم تا توزیع بار عادلانه انجام بشه و فقط روی یه کانفیگ و یه آی‌پی فشار نیافته یا آی‌پی فیلتر نشه. پارامتر بعدیش رندوم بود دیگه کامل مشخصه، از بین این دو حالت رندوم انتخاب می‌کنه.

:::


## ریموت DNS {#remote}

داخل همه کلاینت‌ها بخش Remote DNS توی تنظیمات دیده میشه. ریموت رو وقتی میتونی بفهمی درسته یانه که داری وب‌گردی می‌کنی، داخل خود کلاینت مشخص نمیشه، حتی اسم منم بنویسی بجای یه سرور معتبر داخل کلاینت بازم کانفیگت وصله و پینگ میده، بیای تلگرامم بازم نمی‌فهمی سالمه یا خرابه یا برات فیلتره، تلکرامم کاری به ریموت نداره اصلا و بالا میاد همه جوره.  
بهترین راه اینه که بری سراغ مرورگر و یه سایتی رو باز کنی،دهر سایتی مهم نیست، ما برای تست میریم مثلا داخل این سایت  
[dnsleaktest.com][10]

اگه بالا اومد و یه آی‌پی نشون داد یعنی اوکیه ریموت DNS در حالت کلی مشکل نداره، گزینه تست استاندارد رو بزنید و صبر کنید تا چندتا درخواست ارسال کنه و بعد کوئری‌هارو نمایش بده، توی تست استاندارد اگه همه کوئری‌ها برای یه کشور (لوکیشن کانفیگ یا vpnی که فعاله) نیستن و واسه کشورهای مختلف رو نشون میده دوحالت داره یعنی یا کانفیگت خوب نیست (احتمال %90) و یا که ریموت دی‌ان‌اس جالب نیست، پیشنهاد می‌کنم با کانفیگ دیگه‌ای هم تست کنید.  

ولی نوع بدتر ماجرا اینه که از بین پنج شیش تا کشوری که برات نمایش داده، یکی دوتاشون لوکیشن واقعی خودت یعنی ایران بوده باشن این دیگه یعنی کانفیگ یا vpnی که فعال کردی آشغاله. چندتا از ریموت سرور‌های خوب رو می‌نویسم پایینتر.

::: info INFO

[**مشاهده لیست سایت‌های مختلف تست DNS و IP**][11]

:::

<br/> 

### نکوباکس — اکسکلیو

ریموت DNS پیشفرضشون دقیقا یادم نیست فکر کنم DoH گوگل بودش حالا هرچی مهم نیست چون یادمه سازگار نبود لا نت ایران و مخوصا کانفیگ‌های worker & page به خاطر همین به محض نصب؛ باید تغییر بدیم به DNS over HTTPS گوگل ولی غیر DoH و در عین حال DoH :sweat_smile:  

<Ltr>

**Google DNS:**  
```
https://8.8.8.8/dns-query
```

**Adguard DNS:**  
```
https://94.140.14.14/dns-query
```

**controlD DNS:**  
```
https://freedns.controld.com/p2
```

**Open DNS Cisco:**  
```
https://208.67.222.222/dns-query
```

**Clean Browsing:**

```
tcp://185.228.168.9
```

**Cernel error**

```
https://dns.kernel-error.de/dns-query
```

**Cloudflare UDP:**

```
udp://1.1.1.1
```

</Ltr>

> این آخری کلادفلر مناسب برای کانفیگای وارپ تو هیدیفای و نکوباکس (وارپ در حال حاضر تو ایران و چین شهید شده)

::: details مشاهده اسکرین‌شات

<br/>
<p align="center">
  <img src="/clients/EX-6.png" alt="Exclave-Remote-DNS" width="640px" />
</p>

:::

<br/>

خلاصه که بستگی داره سرویس دهنده اینترنتمون با کدوم یکی بهتر کار بکنه.طبق تجربه تو این سه سال گوگل و ادگارد برای همه مناسب بودن

::: danger **پیشنهادی**

::: details خواندن ادامه مطلب 

پیشنهاد می‌کنم با یه وورکر یه DNS واسه خودتون بسازید، باهاش می‌تونید از تمام DoH هایی که داخل ایران فیلتر هستن استفاده کنید، اسم سرویس DNA Azadi هست، یه کروه خفن زخمتش رو کشیدن. اینجا آموزش ساختش هست به شکل متن و ویدئو [لینک آموزش ساخت DNS آزادی][12]

<br/>
<p align="center">
  <img src="/clients/EX-7.png" alt="Azadi-DNS" width="640px" />
</p><br/>

بعد از ساخت سرویس DNS شخصی بیاید با [Darkness DNS Tester][13] با وی‌پی‌ان خاموش یکی دوسه بار تست بگیرید ببینید کدوم سرویس پینگ بهتری میده و آدرس همون DNS رو توی پنل آزادی خودتون قرار بدین :wink:

:::

<br/> 

### هیدیفای — ویتوری

**هیدیفای بهتره همون پیشفرض بمونه.**  
پیش‌فرضش اینه:

<Ltr>

```
udp://1.1.11
```

</Ltr>

تنها وقتی تغییرش بدین که سایت ها بالا نمیان همونطور که بالاتر توضیح دادم، طبق تجربه موقع استفاده از کانفیگ‌های ساخته شده با وورکر یا پیج (هم ویلس هم تروجان) باید ریموت پیش‌فرض رو تغییر بدیم به نوع DNS over HTTPS، فرضا یکی از اینا:

<Ltr>

**Google DNS:**

```
https://8.8.8.8/dns-query
```
   
**Adguard DNS:**

```
https://94.140.14.14/dns-query
```
  
**Quad DNS:**

```
https://9.9.9.9/dns-query
```

</Ltr>

::: details مشاهده اسکرین‌شات

<br/>
<p align="center">
  <img src="/clients/EX-8.png" alt="Hiddify-Remote-DNS" width="640px" />
</p>

:::

<br/>

کلاینت v2rayNG از دی‌ان‌اس ipv4 کلادفلر استفاده میکنه به طور پیشفرض: `1.1.1.1`

کم پیش میاد نیاز باشه که تغییر بدیم ولی بازم اگه موقعی نیاز شد سریع گوگل رو میذاریم ب جاش: `8.8.8.8`

دیگه چه کلاینتی موند، نمیدونم بقیه هرچی‌ام که باشه یه فورک از همین چندتا کلاینت اصلی هستش و طبیعتا تنطیماتش هم عین همیناست.

<br/> 

## دی‌ان‌ای مستقیم {#direct}

<Ltr>

**Direct DND / Local DNS**

</Ltr>

دایرکت DNS یه سرور دی‌ان‌اس‌ هستش که برای resolve کردن دامنه‌های `مستقیم` (یعنی اونایی که از پروکسی رد نمی‌شن، مثل سایت‌های ایرانی یا LAN) استفاده می‌شه.  
قبل از اینکه کانفیگ پروکسیمون کانکت بشه، تازه علاوه بر اون کار یه وظیفه‌ دیگه هم داره، اگه کانفیگی که داخل کلاینت داریم تو بخش آدرسش بجای ip از دامنه استفاده شده باشه مثل اکثر کانفیگ‌ها، اونوقت وقتی بخوایم با اون کانفیگ کانکت بشیم کلاینت از طریق همین آدرس `Direct DNS` برای پیدا کردن IP دامنه استفاده می‌کنه، اول دامنه‌ی کانفیگ رو تبدیل می‌کنه به IP و بعد شروع می‌کنه به انجام وظیفه اش، ایجاد تونل و رمزنگاری و tlshello و جدا کردن مسیرها و رد و بدل کردن ترافیک و ... 

- **پیش‌فرض:** معمولاً DNS سیستم اندروید (مثل 8.8.8.8 گوگل یا 1.1.1.1 کلادفلر) رو می‌گیره.

- **چرا مهمه؟** اگه ISP‌ت DNS رو مسدود یا دستکاری کنه، سایت‌های داخلی لود نمی‌شن.

- **پیشنهاد:** توی تنظیمات Exclave، گزینه "Use system DNS as Direct DNS" رو خاموش کن و تو کادر زیرش که نوشته "Direct DNS" بیا و `8.8.8.8` بذار تا فیکس همیشه از گوگل استفاده کنه، تو ایران ipv4 اون فیلتر نیست و سریعم که هست و دیگه آدم کور مگه از خدا چی میخواد؟؟

برای Nekobox هم به همین شکله فقط دیگه اون گزیه رو نداره که روشن یا خاموش بکنید، توی نکوباکس اکه توی کادر Direct DNS بنویسی `local` همینجوری با حروف کوچیک اونوقت از دی‌ان‌اس داخلی اندروید استفاده می‌کنه و میتونی بذاری لوکال بمونه یا که مثل توضیح پاراگراف قبلی اینجاهم `8.8.8.8` قرار بدی.

هم‌چنین برای Direct یا همون Local DNS می‌تونی یه DNS سرور عمومی بی‌طرف و بی دردسر و فیلتر نشده مثل علی‌بابا استفاده کنی، در اینصورت بازم همونطور که بالاتر گفتم باید اول گزینه `Use system DNS as Direct dns` رو خاموش کنی بعد اقدام کنی برای قرار دادن سرور دلخواه تو کادر زیرش، این علی باباعه:

<Ltr>
  
```
https://223.5.5.5/dns-query
```

</Ltr>
<br/>

::: tip **سفارشی سازی**

اگه می‌خوای سفارشی کنی می‌تونی، از DNS‌های خوب ایرانی مثل شِکَن یا الکترو استفاده کنی تا سایت‌های داخلی سریع‌تر باز شن. توی هردو کلاینت مشابهه، تو این آدرس می‌تونی پیداش کنی:

<Ltr>

> DNS Settings > Direct DNS  
  
**Shekan DNS**
 
```
178.22.122.100
```

**Electro DNS**

```
78.157.42.100
```

</Ltr>

:::

<br/> 

## فعال‌سازی مسیریابی DNS {#dns-routing}

توی تنظیمات نکوباکس و exclave در بخش DNS settings یه گزینه مهم هست به اسم `Enable DNS routing`، روشن بودن این گزینه یعنی کوئری‌های DNS‌ت (درخواست‌های تبدیل دامنه به IP) رو از طریق پروکسی (تونل VPN) می‌فرسته به جای اینکه مستقیم به DNS دایرکت بره و در مواردی لوکیشنت لو بره، میاد و از پروکسی رد می‌شه و خب این امن‌تره. توی بکاپ‌های من پیش‌فرض همیشه روشنه این گزینه. 

نحوه فعال کردنش توی هردو کلاینت مشابهه، برو به این آدرس:  

<Ltr>
  
> Settings > Enable DNS Routing  

</Ltr>

و با دکمه مقابلش اونو فعال کن.

- **مزایا:** جلوگیری از DNS Leak، یعنی اینطوری دیگه لوکیشنت لو نمیره. اگه خاموش باشه، DNS مستقیم میره و ممکنه فیلتر بشه.
  
- **معایب:** ممکنه اتصالت کمی کندتر بشه (متوجهش نخواهی شد) چون DNS هم تونل می‌شه.

- **پیشنهاد:** همیشه روشن کن، مگر اینکه مشکلی با سرعت داشته باشی.

::: details اسکرین‌شات از بخش تنظیمات DNS

<br/> 
<p align="center">
  <img src="/clients/EX-9.png" alt="DNS-Routing" width="640px" />
</p>

:::

<br/>

### فعال‌سازی Fake DNS {#fake-dns}

توی کلاینت یه گزینه دیگه هست به اسم `Fake DNS` که عموما ما کاریش نداریم و اونو خاموش می‌ذاریم ولی یه توضیح مختصری دربارش می‌نویسم.  
یه ترفند ضد نشت هست که دامنه‌های بلاک‌شده رو به IP‌های فیک مثل `198.18.0.0/15` resolve می‌کنه. بعد، کلاینت می‌فهمه که این IP فیکه و ترافیک رو به پروکسی می‌فرسته. اینطوری، حتی اگه DNS اصلی فیلتر باشه، اتصال برقرار می‌شه.

**کارش چیه؟**   
وقتی Strict Route فعاله، کلاینت مطمئن می‌شه که حتی یه دونه درخواست DNS هم از تونل VPN بیرون نمیره. اگه غیرفعاله، ممکنه بعضی درخواست‌ها مستقیم به ISP برن و فیلتر بشن یا لوکیشنت لو بره.

**مشکلش چیه؟**  
اگه سرور DNS که انتخاب کردی (مثل Remote DNS یا Direct DNS) درست کار نکنه یا با کانفیگت سازگار نباشه، ممکنه اینترنتت کلاً قطع بشه، چون دیگه هیچ دامنه‌ای resolve نمی‌شه.

**کی استفاده کن؟**  
وقتی Strict Route فعاله (توی Inbound options) و DNS Leak داری.

توی nekobox و exclave نداریم این گزینه strict route ولی توی hiddify (اندروید و دسکتاپ) و کلاینت رسمی سینگ‌باکس و هم‌چنین کانفیگ‌هایی که [متناسب با ساختار هسته سینگباکس][14] می‌نویسیم هست و بیشتر هدفم از نوشتن توضیح fake dns بخاطر این‌ چندتا بود.

::: danger **نکته**

اگه بعد از فعال کردن Strict Route اینترنت قطع شد، Fake DNS رو روشن کن و روتینگ‌ها رو چک کن (ممکنه تداخل داشته باشه).

:::

<br/>

## تست اتصال URL {#url-test}

داخل نکوباکس و هیدیفتی و exclave مهمتر از ریموت دی‌ان‌اس این سرور تست هستش، منظورم این قسمته: `connection test URL`

که پیشفرض روی این یکی قرار داره:  

<Ltr>

```
http://cp.cloudflare.com
```

</Ltr>

که در اولین فرصت باید تغییر بدیم به:  

<Ltr>

```
http://www.google.com/generate_204
```

</Ltr>

و یا این هم بدک نیست:

<Ltr>
  
```
https://clients3.google.com/generate_204
```

</Ltr>

::: details مشاهده اسکرین‌شات

<br/>
<p align="center">
  <img src="/clients/EX-10.png" alt="UR-Test-Server" width="640px" />
</p>

:::

<br/>

اگه این پیش‌فرض خودش بمونه و اصلاح نکنید موقع تست گرفتن کل کانفیگ هارو یا خراب نشون میده یا پینگ کاذب میده و الکی یه عدد سبز رنگ می‌زنه کنارشون درحالی که موقع اتصال هیچ داده‌ای رد و بدل نمی‌شه.

::: tip **این‌جا یه لیست از سرورهای تست برای استفاده داخل کلاینت‌ها داریم**

::: details  برای مشاهده لیست اینجا کلیک کنید

- پیشنهاد استفاده از فقط 5 تای اول، بقیه صرفا جهت خالی نموندن عریضه

<Ltr>

- https://www.gstatic.com/generate_204

- https://clients3.google.com/generate_204

- https://www.google.com/gen_204

- https://api.v2fly.org/checkConnection.svgz

- https://api.telegram.org/robots.txt

- https://cp.cloudflare.com/

- https://connectivitycheck.android.com/generate_204

- https://connectivity.gstatic.com/generate_204

- http://cachefly.cachefly.net/10mb.test

- https://play.googleapis.com/generate_204

- https://captive.apple.com

- https://cp.cloudflare.com/generate_204

- https://www.qualcomm.cn/generate_204

- https://www.google.com/generate_204

- https://browserleaks.com/ip

- https://api.v2fly.org/checkConnection.svgz

- https://speed.cloudflare.com

- https://check.firewalla.com

- http://www.gstatic.com/generate_204

- https://172.217.6.238/generate_204

- https://e.foundation/net_204/

- https://elementary.io/generate_204

- https://httpstat.us/204

- https://attwifi.apple.com/library/test/success.html

- https://connectivitycheck.grapheneos.network/generate_204

- https://grapheneos.online/gen_204

- https://grapheneos.online/generate_204

- https://captiveportal.kuketz.de

- https://captive.v2ex.co/generate_204

- https://www.google-analytics.com/generate_204

- https://www.msftconnecttest.com/connecttest.txt

- https://detectportal.firefox.com/success.txt

- https://www.v2ex.com/generate_204

- https://connect.rom.miui.com/generate_204

- https://connectivitycheck.platform.hicloud.com/generate_204

- https://wifi.vivo.com.cn/generate_204

- https://cdn.capenetworks.io/auth

- https://cdn.capenetworks.io/connectivity-check

- https://35.241.22.134/auth.html

- https://35.241.22.134/connectivity-check

- https://captive.apple.com/hotspot-detect.html

- https://www.msftncsi.com/ncsi.txt

- https://connectivitycheck.android.com/generate_204

- https://connectivitycheck.gstatic.com/generate_204

- https://www.apple.com/library/test/success.html

</Ltr>

:::

<br/> 

## پیاده‌سازی TUN Or Stack

اصلا اول بگیم **TUN** چیه.

یه روشه که کلاینت‌های VPN (مثل Nekobox و Exclave و Hiddify و Singbox و خیلی‌های دیگه) ازش استفاده می‌کنن تا ترافیک اینترنتت رو از طریق تونل VPN هدایت کنن. بخوام خیلی ساده بگم، TUN یه لایه مجازی می‌سازه که انگار کل ترافیک گوشی‌مون از یه مسیر یا از یه تونل امن رد میشه. حالا این **TUN Implementation** (یا تو بعضی کلاینت‌ها اونو ب اسم Stack می‌شناسیم) مشخص می‌کنه که این تونل چطور پیاده‌سازی بشه. هر کدوم از این سه گزینه (System، gVisor، Mixed) یه روش متفاوت برای مدیریت این تونله.

**کجا پیداش می‌کنی؟** 

- **توی Nekobox برو به:**
  
<Ltr>

Settings > TUN Settings > TUN Implementation.

</Ltr>

- **توی Exclave هم توی:**

<Ltr>

Settings > TUN Settings > Stack.

</Ltr>

- **توی هیدیفای هم توی:**  

<Ltr>

Config options > inbound options > TUN implementation.

</Ltr>  

- **چرا مهمه؟** انتخاب درست این گزینه می‌تونه باعث بشه اتصالت سریع‌تر، پایدارتر، یا امن‌تر بشه. انتخاب اشتباه هم ممکنه باعث قطع شدن اینترنت یا کندی بشه.

::: details مشاهده اسکرین‌شات

<br/>
<p align="center">
  <img src="/clients/EX-11.png" alt="TUN-Implementation" width="640px" />
</p>

:::

<br/>

### انواع TUN

#### 1. گزینه System
این گزینه از سیستم‌عامل اندروید (یا همون TUN داخلی گوشی) برای مدیریت تونل VPN استفاده می‌کنه. یعنی کلاینت مستقیماً از امکانات خود اندروید برای هدایت ترافیک استفاده می‌کنه.

<br/>

**مزایا:**
- **سرعت بالا:** چون مستقیم از سیستم‌عامل استفاده می‌کنه، معمولاً سریع‌ترین گزینه‌ست.
- **مصرف باتری کمتر:** فشار کمتری به CPU گوشی میاره.
- **سازگاری خوب:** با اکثر دستگاه‌ها و کانفیگ‌ها خوب کار می‌کنه.

<br/>
  
**معایب:**
- **امنیت کمتر:** چون از سیستم‌عامل استفاده می‌کنه، ممکنه در برابر DNS Leak یا فیلترینگ‌های پیشرفته‌تر آسیب‌پذیرتر باشه.
- **کنترل کمتر:** اگه ISP یا سیستم‌عاملت DNS رو دستکاری کنه، ممکنه مشکلاتی مثل لود نشدن سایت‌ها پیش بیاد.

<br/>

**کی استفاده کن؟**  
- اگه دنبال سرعت و پایداری هستی و امنیت خیلی برات حیاتی نیست (مثلاً برای گیم یا استریم)، System گزینه خوبیه.
- همچنین اگه دستگاهت قدیمیه یا سخت‌افزار ضعیفی داره، این گزینه بهتر کار می‌کنه.

<br/>

#### 2. گزینه gVisor
**gVisor** یه تکنولوژی ساخته گوگل برای ایجاد یه محیط ایزوله و امن برای اجرای کدهای شبکه‌ست. تو این حالت، به جای استفاده از TUN سیستم‌عامل، یه لایه مجازی جداگونه (مثل یه ماشین مجازی سبک) می‌سازه که ترافیک رو مدیریت می‌کنه.

<br/> 

**مزایا:**
- **امنیت بالا:** چون ترافیک تو یه محیط ایزوله پردازش می‌شه، احتمال DNS Leak یا لو رفتن اطلاعات خیلی کمه.
- **پشتیبانی از تنظیمات پیچیده:** برای کانفیگ‌های خاص (مثل VLESS یا Trojan با تنظیمات پیشرفته) بهتر کار می‌کنه.
- **مقاومت در برابر فیلترینگ:** تو ایران که فیلترینگ DNS و پروتکل‌ها زیاده، gVisor می‌تونه بهتر عمل کنه.

<br/>

**معایب:**
- **سرعت کمتر:** چون یه لایه اضافی داره، ممکنه کمی کندتر از System باشه.- **مصرف باتری بیشتر:** پردازش تو محیط gVisor به پردارنده (CPU) فشار بیشتری میاره.
- **مشکلات احتمالی:** تو بعضی دستگاه‌های قدیمی یا با رم کم، ممکنه باعث کرش یا قطع شدن اتصال بشه.

<br/>

**کی استفاده کن؟**
- اگه امنیت برات اولویت داره (مثلاً برای دور زدن فیلترینگ‌های سخت یا جلوگیری از DNS Leak)، gVisor بهترین انتخابه.
- مخصوصاً اگه از کانفیگ‌های پیچیده یا سرورهای شخصی استفاده می‌کنی.

<br/> 

#### 3. گزینه Mixed
این گزینه یه حالت هیبریدیه که سعی می‌کنه مزایای System و gVisor رو ترکیب کنه. تو این حالت، کلاینت بسته به نوع ترافیک یا تنظیمات، بین System و gVisor سوییچ می‌کنه.

<br/>

**مزایا:**
- **تعادل بین سرعت و امنیت:** برای ترافیک‌های حساس (مثل سایت‌های فیلترشده) از gVisor استفاده می‌کنه و برای بقیه از System.
- **انعطاف‌پذیری:** اگه مطمئن نیستی کدوم گزینه بهتره، Mixed یه انتخاب وسطه.

<br/>

**معایب:**
- **پیچیدگی:** چون بین دو حالت سوییچ می‌کنه، ممکنه تو بعضی موارد ناپایدار باشه یا تنظیمات رو درست تشخیص نده.
- **نیاز به تست:** باید ببینی با کانفیگ‌ها و دستگاهت خوب کار می‌کنه یا نه.

<br/>

**کی استفاده کن؟**
- اگه نمی‌دونی کدوم گزینه بهتره یا کانفیگ‌های متنوعی داری (مثلاً هم vless ساده داری هم reality یا hysteria پیشرفته)، Mixed می‌تونه یه نقطه شروع خوب باشه.

### کدوم رو انتخاب کنیم؟

برای اکثر کاربران تو ایران، این پیشنهادات رو دارم:

1. **اگه تازه‌کاری یا دستگاهت قدیمیه:** با **System** شروع کن. سرعتش خوبه و معمولاً بدون دردسر کار می‌کنه.
2. **اگه امنیت و دور زدن فیلترینگ برات مهمه:** **gVisor** رو انتخاب کن، مخصوصاً اگه از **Strict Route** و **Fake DNS** استفاده می‌کنی (که تو بخش قبلی توضیح دادم). فقط مطمئن شو Remote DNS درست تنظیم شده باشه مثل `https://8.8.8.8/dns-query`
3. **اگه نمی‌دونی چی به چیه:** **Mixed** رو بزن و تست کن. اگه مشکلی پیش اومد، به یکی از دو گزینه دیگه سوییچ کن.

### نکات مهم برای تنظیم TUN Implementation
- **تست DNS Leak:** بعد از انتخاب هر کدوم از این گزینه‌ها، حتماً با [dnsleaktest.com][10] یا [ipleak.net][15] چک کن که لوکیشنت لو نره. gVisor معمولاً امن‌تره، ولی System ممکنه DNS Leak بده. توی تست استاندارد با [این سایت][10] همه‌ی کوئری‌ها باید هماهنگ با لوکیشن آی‌پی کاتفیگت باشن و میکس چندتا کشور مختلف نباشن، اگه یکی از کوئری ها ایران باشه که فاجعه‌ست اوضاع.

- **سازگاری با Strict Route و Fake DNS:** اگه **Strict Route** رو فعال کردی، بهتره gVisor یا Mixed رو انتخاب کنی، چون System ممکنه با Strict Route ناسازگار باشه و باعث قطعی بشه. Fake DNS هم با gVisor بهتر کار می‌کنه.
- **مشکلات سرعت یا قطعی:** اگه با gVisor یا Mixed سرعتت کم شد یا اتصالت قطع شد، اول Remote DNS رو چک کن (مثلاً عوضش کن به Adguard DNS). اگه درست نشد، برگرد به System.
- **دستگاه‌های ضعیف:** اگه گوشیت قدیمیه یا بدرد نخوره (مثل اکثر شیائومی‌ها) یا رم کم داره (مثلاً زیر 4 گیگ) یا CPU ضعیفی داره، gVisor ممکنه باعث لگ یا کرش بشه. تو این حالت System بهتره.

**حرف آخر**  
انتخاب بین **System**، **gVisor**، و **Mixed** بستگی به نیازت داره: سرعت، امنیت، یا یه چیزی بین این دوتا. پیشنهاد من اینه که با **gVisor** شروع کنی، چون تو ایران با فیلترینگ‌های سنگین، امنیتش به کار میاد. اگه مشکلی پیش اومد، به Mixed یا System سوییچ کن. همیشه بعد از تغییر تنظیمات، با یه تست ساده (مثل باز کردن یه سایت فیلترشده یا چک کردن [dnsleaktest.com][10]) مطمئن شو همه‌چیز درست کار می‌کنه.

<br/> 

## خلاصه پیشنهادات {#summary}

### توی نکوباکس/اکسکیو

- **Remote DNS** ← `https://8.8.8.8/dns-query`
- **Direct DNS** ← رو روی سیستم بذار
- **DNS Routing** ← روشن کن
- **Fake DNS** ← رو خاموش
- **Use system DNS as Bootstrap DNS** ← روشن بذار
- **Enable Sniffing** ← روشن بذار
- **Hijack DNS** ← روشن بذار
- **TUN Implementation/Stack** ← gVisor بذار مگه اینکه گوشی قدیمی باشه اون وقت system بذارش
- **Connection Test URL** ← حتما پیش‌فرض رو به آدرس زیر تغییر بده

<Ltr>

```
http://www.gstatic.com/generate_204
```

</Ltr>
<br/>

### توی هیدیفای

- **Remote DNS** ← پیش‌فرض یا `https://8.8.8.8/dns-query`
- **Direct DNS** ← پیش‌فرض `1.1.1.1`
- **DNS Routing** ← روشن کن
- **Strict Route** ← روشن کن
- **TUN Implementation** ← gVisor بذار
- **Connection Test URL** ←حتما پیش‌فرض رو به آدرس زیر تغییر بده

<Ltr>

```
http://www.gstatic.com/generate_204
```

</Ltr>
<br/> 

### توی ویتوری ان‌جی و مهسا ان‌جی

- **Sniffing** ← روشن بذار حتما
- **Local DNS** ← روشنش کن
- **Fake DNS** ← خاموش کن
- **Mux** ← همیشه خاموش
- **Fragment** ← پیش‌فرض خاموش، درصورت فیلتر شدن دامنه کانفیگ روشن می‌کنیم.
  - **Length** ← 10-30
  - **Interval** ← 1-2
  - **Packets** ← tlshello
- **Allow Insecure** ← همیشه روشن باشه
- **Remote DNS** ← `1.1.1.1` یا `8.8.8.8`
- **Domestic DNS** ← مثل ریموت `1.1.1.1`
- **Intelligent Selection Method** ← Least Ping
- **Connection Test URL** ← چک کن حتما مثل آدرس زیر باشه: 

<Ltr>

```
https://www.gstatic.com/generate_204
```

</Ltr>
<br/>

اینطوری کلاینت‌ها یه ستینگ اصولی، ایده‌آل، استاندارد مطابق ساختار و دسورالعمل‌های توصیه شده در هسته‌ xray و singbox و از همه مهمتر یه اتصال پایدار و ایمن دارن 😎.

<br/> 

## لینک‌های دانلود {#download}

- [نکوباکس گیت‌هاب][1]
  - [نکوباکس از انباری][8]
  - [فایل بکاپ نکوباکس][4]
- [گیت‌هاب Exclave][5]
  - [فایل نصبی Exclave از انباری][2]
  - [فایل بکاپ Exclave][9]
- [مخزن لینک‌های ساب][3]

[1]: https://github.com/MatsuriDayo/NekoBoxForAndroid/releases
[2]: https://t.me/new_folder_revil/3417
[3]: https://github.com/NiREvil/vless/ 
[4]: https://t.me/new_folder_revil/3497
[5]: https://github.com/dyhkwong/Exclave/releases
[6]: https://t.me/F_NiREvil/5123
[7]: https://t.me/F_NiREvil/5518
[8]: https://t.me/new_folder_revil/3495
[9]: https://t.me/new_folder_revil/3412
[10]: https://www.dnsleaktest.com/
[11]: https://t.me/F_NiREvil/620
[12]: https://github.com/NiREvil/vless/tree/main/DNS%20over%20HTTPS/Azadi-DNS
[13]: https://diana-cl.github.io/Diana-Cl/topics/iran-core#%D8%AA%D8%B3%D8%AA%D8%B1-dns
[14]: https://raw.githubusercontent.com/NiREvil/vless/refs/heads/main/hiddify/H2%20SINGBOX%20HOSS
[15]: https://ipleak.net/
